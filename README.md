# Final project - Mai Finance Helper

## Deployed version url:

https://sharkam.github.io/blockchain-developer-bootcamp-final-project/

## How to run this project locally:

### Prerequisites

-   Node.js >= v14
-   Truffle and Ganache
-   Npm
-   `git checkout main`

### Contracts

-   Run `npm install` in project root to install Truffle build and smart contract dependencies
-   Run local testnet on port `7545` with network id setup to 1337 forking the polygon mainnet(I used alchemy api for the fork, you'll need an API Key) :
-   `ganache-cli --fork https://polygon-mainnet.g.alchemy.com/v2/[YOUR-API] -p 7545 --networkId 1337`
-   `truffle test`
-   `development` network id is 1337, remember to change it in Metamask as well!

### Frontend

-   `cd client`
-   `npm install`
-   `npm start`
-   Open `http://localhost:3000`

### Get some link tokens locally

-   `truffle migrate`
-   `truffle test` : This will end leaving some link in the wallet accounts[0] generated by ganache, you'll need to use the same address for your tests on the UI
-   `cd client && npm start`
-   Open local ui from `http://localhost:3000`
-   Make sure your Metamask localhost network is in port `7545` and chain id is `1337`.
-   Import the first address generated by ganache in your metamask using the private key shown by ganache
-   If you get `TXRejectedError` when sending a transaction, reset your Metamask account from Advanced settings.
-   When you open the link vault you should see a link balance from your wallet

## Screencast link

## Public Ethereum wallet for certification:

`0xb52b4bd16D32e84Fa74f8CC46F4B6546a095bBc4`

## Project description

This project is built on top of https://app.mai.finance/.
It allows a user to borrow stable coins(MAI) against a chosen collateral asset at a 0% rate + gain weekly rewards for borrowing.
This also allows someone to long an asset, the only problem with longing an asset using this method is that it is a tedious task :

1-Create vault  
2-Deposit asset A as collateral  
3-Borrow MAI with desired HF (Health Factor)  
4-Buy A with borrowed MAI  
5-Deposit A for more collateral  
6-Repeat 3,4,5 as many times as you want/can (Depending on your risk tolerance)

This project aims to allow a user to automate this process in one click by letting him choose his leverage and what percentage of the initial he would like to risk, that would also make it a lot easier to withdraw as the withdrawing is pretty much all the steps above but in a reverse order.

## Workflow

1 - On the first page the user is presented with all the assets available to use as collateral on https://app.mai.finance/ :  
2 - The user connects to the Web site using his Metamask
3 - The user select the collateral he wants to long  
4 - The user creates a vault for this collateral (Those are MAI finance vaults)
5 - After selecting a vault, the user can choose how many tokens of the selected asset he wants to use as collateral  
6 - Then he can choose his leverage for the long
7 - The interface display the liquidation price once all the parameters have been selected  
8 - The user can choose to reduce his leverage or stop the long by repaying the full debt amount
9 - The user ends up with more or less collateral depending on the price appreciation of the longed asset

## Scheduled workflow for rewards

1. Run scheduled contract weekly to update the amount of rewards available (Manually for now, to be implemented with chainlink keepers)
2. User will see his amount of rewards claimable once it has been updated in the contract
3. If the amount is bigger than 0, the user can click on the claim button

## Directory structure

-   `client`: Project's React frontend.
-   `contracts`: Smart contracts, only can be tested locally with a polygon mainnet fork since lot of mandatory contracts are only deployed on polygon mainnet.
-   `migrations`: Migration files for deploying contracts in `contracts` directory.
-   `test`: Tests for smart contracts.

## Environment variables to run `truffle test` on your local env

You need to add the public/private keys from the first account generated by ganache in your .env

```
TEST_WALLET_PUBLIC_KEY=
TEST_WALLET_PRIVATE_KEY=
```

## TODO features

-   Give the choice to the user to automatically stake his Qi rewards in Mai finance
-   Give the choice to the user to withdraw the Mai finance NFT vault to get the ownership
-   Add missing vault types
-   Optimize how to swap the assets for the flash loan
-   Add chainlink keepers to automate the update of the variable `balanceRewardsByPeriod`
